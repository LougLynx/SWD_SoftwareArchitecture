@model SWD_SoftwareArchitecture.ViewModels.CourseDetailViewModel

@{
    ViewData["Title"] = "Demo Chi tiết Khóa học";
    
    // === FIX CỨNG ID SINH VIÊN ===
    int studentInProgressId = 6; 
    int studentCompletedId = 7; 
}

<div class="jumbotron">
    <h1 class="display-4">@Model.Course.Title</h1>
    <p class="lead">@Model.Course.Description</p>
</div>

<hr />

<div class="card mb-4">
    <div class="card-header">
        <h4><i class="fas fa-list-ul"></i> Nội dung khóa học (Demo UC-03)</h4>
    </div>
    <div class="card-body">
        @foreach (var module in Model.Modules)
        {
            <h5 class="mt-3">@module.Title</h5>
            <ul class="list-group">
                @foreach (var lesson in module.Lessons)
                {
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            @if (lesson.ContentType == "VirtualClassroom") {
                                <i class="fas fa-chalkboard-teacher text-success"></i>
                            } else {
                                <i class="fas fa-file-alt text-secondary"></i>
                            }
                            <span class="ms-2">@lesson.Title</span>
                        </div>
                        
                        @if (lesson.ContentType == "VirtualClassroom")
                        {
                            <a asp-controller="Lesson" asp-action="JoinOnlineClass" 
                               asp-route-lessonId="@lesson.LessonId" 
                               asp-route-studentId="@studentInProgressId"
                               class="btn btn-success btn-sm">
                                <i class="fas fa-video"></i> Join Class (UC-03)
                            </a>
                        } else {
                            <a href="@lesson.ContentUrl" target="_blank" class="btn btn-outline-secondary btn-sm">Xem Nội dung</a>
                        }
                    </li>
                }
            </ul>
        }
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h4><i class="fas fa-graduation-cap"></i> Tiến độ & Chứng chỉ (Demo UC-04 & UC-05)</h4>
    </div>
    <div class="card-body">
        <div class="row">
            
            <div class="col-md-6">
                <h5>Kịch bản 1: Sinh viên ĐANG HỌC (ID: @studentInProgressId)</h5>
                <p>Tiến độ: @Model.StudentInProgress.CompletionPercentage%</p>
                
                <a asp-controller="Progress" asp-action="MyProgress" 
                   asp-route-courseId="@Model.Course.CourseId" 
                   asp-route-studentId="@studentInProgressId"
                   class="btn btn-primary">
                    Xem chi tiết tiến độ (UC-04)
                </a>
                
                <a href="#" class="btn btn-secondary disabled" title="Hoàn thành 100% để mở khóa">
                    Tải chứng chỉ (UC-05)
                </a>
            </div>
            
            <div class="col-md-6">
                <h5>Kịch bản 2: Sinh viên ĐÃ HOÀN THÀNH (ID: @studentCompletedId)</h5>
                <p>Tiến độ: @Model.StudentCompleted.CompletionPercentage%</p>
                
                <a asp-controller="Progress" asp-action="MyProgress" 
                   asp-route-courseId="@Model.Course.CourseId" 
                   asp-route-studentId="@studentCompletedId"
                   class="btn btn-primary">
                    Xem chi tiết tiến độ (UC-04)
                </a>
                
                <a asp-controller="Certificate" asp-action="DownloadCertificate" 
                   asp-route-courseId="@Model.Course.CourseId" 
                   asp-route-studentId="@studentCompletedId"
                   class="btn btn-success">
                    <i class="fas fa-download"></i> Tải chứng chỉ (UC-05)
                </a>
            </div>
        </div>
    </div>
</div>